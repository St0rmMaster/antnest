# Системная инструкция для ИИ-агента

> **Назначение:** описание возможностей и оптимального использования ИИ-агента для управления инфраструктурой

## Основные возможности

### Анализ и понимание кода
- Чтение, анализ и понимание кодовых баз на множественных языках программирования
- Навигация по файловой структуре проектов
- Понимание архитектурных паттернов и зависимостей
- Анализ конфигурационных файлов (YAML, JSON, XML, etc.)

### Разработка и модификация кода
- Создание нового кода с нуля
- Рефакторинг существующего кода с минимальными изменениями
- Исправление багов и уязвимостей
- Оптимизация производительности
- Добавление новой функциональности

### Работа с инфраструктурой
- Анализ конфигураций Docker, Docker Compose
- Работа с конфигурациями Proxmox, LXC контейнеров
- Управление базами данных (PostgreSQL, MariaDB/MySQL)
- Настройка веб-серверов (nginx, Apache)
- Конфигурирование сервисов (systemd, init scripts)

### Документирование
- Создание и обновление технической документации
- Следование стандартам форматирования проекта
- Создание README, runbook'ов, инструкций
- Документирование API и конфигураций

### Тестирование и отладка
- Написание unit и integration тестов
- Запуск существующих тестов
- Анализ логов и диагностика проблем
- Профилирование и мониторинг

## Оптимальное использование

### Для задач инфраструктуры antnest

**Лучше всего использовать для:**
- Обновления конфигураций в `infra.yaml`
- Создания новых карточек сервисов/контейнеров
- Автоматизации развертывания сервисов
- Диагностики проблем в Docker контейнерах
- Настройки баз данных и миграций
- Создания backup/restore скриптов
- Обновления nginx конфигураций

**Примеры команд:**
```bash
# Анализ состояния контейнера
docker ps && docker logs n8n

# Проверка PostgreSQL
psql -h 192.168.1.110 -U n8nuser -d n8n -c "\dt"

# Диагностика nginx
nginx -t && systemctl status nginx
```

### Рабочий процесс

1. **Анализ задачи** — чтение существующих конфигураций и понимание требований
2. **Минимальные изменения** — внесение хирургически точных правок
3. **Тестирование** — проверка работоспособности изменений
4. **Документирование** — обновление карточек в `infra.yaml` и README

### Ограничения

**НЕ может:**
- Прямо подключаться к удаленным серверам
- Выполнять команды на хостах вне песочницы
- Получать доступ к внешним API без соответствующих учетных данных
- Изменять live-системы без явного разрешения

**Требует осторожности при:**
- Изменении критических конфигураций (nginx, PostgreSQL)
- Работе с секретами и паролями
- Модификации systemd сервисов
- Изменении сетевых настроек

## Формат взаимодействия

### Входные данные
- Четкое описание задачи
- Контекст проблемы/требования
- Указание приоритетных ограничений
- Доступ к логам/ошибкам (если есть)

### Выходные данные
- Пошаговый план выполнения
- Минимальные изменения кода/конфигов
- Команды для проверки результата
- Обновленная документация

### Примеры задач

**Хорошие задачи:**
- "Добавь новую базу данных для сервиса XYZ в PostgreSQL"
- "Настрой reverse proxy для нового контейнера на порт 8080"
- "Исправь проблему с подключением n8n к базе данных"
- "Создай backup скрипт для Docker volumes"

**Нечеткие задачи (требуют уточнения):**
- "Сломался сервер" — нужны логи и детали
- "Оптимизируй все" — нужны конкретные метрики/проблемы
- "Измени безопасность" — нужны требования безопасности

## Специфика проекта antnest

### Структура данных
- **Источник правды:** `infra.yaml` — все изменения отражать здесь
- **Документация:** следовать шаблонам из README.md
- **Секреты:** хранить отдельно, ссылаться в конфигах

### Принципы работы
- **Минимальность:** изменять только необходимое
- **Обновляемость:** всегда поддерживать актуальность `infra.yaml`
- **Проверяемость:** добавлять команды проверки в карточки
- **Единообразие:** следовать существующему нейминг-соглашению

### Контейнеры и сервисы
- LXC контейнеры: `lxc-<id>-<имя>`
- IP адреса: диапазон 192.168.1.110-160
- Сервисы: PostgreSQL (110), n8n (120), прочие (130+)
- Проброс портов: через nginx reverse proxy

---

*Инструкция создана: 2024-12-19*