# Справочник инфраструктуры

> **Источник правды** для всей инфраструктуры проекта. Любое изменение → правка карточки.

## Файлы

- **host.md** — карточка хоста Proxmox VE
- **containers.md** — карточки всех LXC контейнеров  
- **services.md** — карточки всех сервисов и ботов
- **secrets.md** — пароли и учётные данные
- **issues.md** — типичные проблемы и их решения
- **AGENT_INSTRUCTIONS.md** — системная инструкция для ИИ-агента
- **README.md** — этот файл с документацией

## Регламент

- **Источник правды — эти файлы.** Любое изменение в инфраструктуре → правка соответствующей карточки в течение суток.
- **Один объект — одна карточка.** Хост/контейнер/сервис описываются отдельно.
- **Runbook хранится в карточке сервиса** (раздел «Операции»), кратко и пошагово.
- **Секреты в отдельном файле.** В карточках только ссылки на secrets.md.
- **Команды давать проверенные**, по шагам, с кратким «зачем».
- **Минимум форматирования:** заголовки, списки, код-блоки.
- **Обновляемость:** при изменении портов, путей, доменов, зависимостей — правка сразу же.
- **Единый нейминг:** `lxc-<id>-<краткое-имя>`; сервисы — `<stack>-<роль>`.

## Форматирование

- **Формат:** простой текст/Markdown (заголовки, списки, кодовые блоки для команд)
- **Язык:** русский, **команды** — латиницей, без кириллицы
- **Лаконичность:** списки вместо прозы; 1–2 строки на пункт
- **Даты:** `YYYY-MM-DD`. Часовой пояс не указывать

## Шаблон карточки ХОСТА

```markdown
# Хост — [Название]

**Назначение:** [краткое описание]

**Железо:** 
- CPU: [модель/количество ядер]
- RAM: [объем]
- Диски: [конфигурация]

**Сеть:** 
- [описание сетевой конфигурации]

**Хранилища:** 
- [список хранилищ и их назначение]

**Службы на хосте:**
- [список служб]

**Известные грабли:**
- [список известных проблем]

**Обновлено:** YYYY-MM-DD
```

## Шаблон карточки КОНТЕЙНЕРА

```markdown
# lxc-<id>-<имя>

**Роль:** [назначение контейнера]

**Расположение:** 
- Хост: [название хоста]
- IP: [IP адрес]

**Ресурсы:** 
- CPU: [количество ядер]
- RAM: [объем памяти]
- Disk: [размер диска]

**Сеть/Порты:** 
- [список портов и их назначение]

**Данные/тома:** 
- [ключевые пути данных]

**Сервисы внутри:** 
- [список сервисов]

**Пароль root:** см. secrets.md

**Известные грабли:**
- [список известных проблем]

**Обновлено:** YYYY-MM-DD
```

## Шаблон карточки СЕРВИСА

```markdown
# [имя-сервиса]

**Назначение:** [краткое описание функции в 1-2 строки]

**Расположение:** 
- Контейнер: [название контейнера]
- URL: [если есть веб-интерфейс]

**Интерфейсы/Порты:** 
- [внешние точки входа]

**Данные:** 
- [где хранит состояние/файлы]

**Зависимости:** 
- [БД, очереди, внешние API]

**Конфигурация:** 
- [путь к конфигурационному файлу]
- Секреты: см. secrets.md

**Мониторинг:** 
- [как проверить работоспособность]

## Операции

### Обновление
1. [шаг 1]
2. [шаг 2]
3. [проверка]

### Бэкап/восстановление
1. [шаг 1]
2. [шаг 2]
3. [проверка]

**Известные грабли:**
- [список известных проблем]

**Обновлено:** YYYY-MM-DD
```

## Пример заполнения secrets.md

```markdown
# Секреты и пароли

## Контейнеры
- lxc-110-root: пароль_тут
- lxc-120-root: пароль_тут

## PostgreSQL  
- appuser: пароль_тут
- n8nuser: пароль_тут

## n8n
- basic-auth: логин / пароль
- api-key: ключ_тут
```

---

*Справочник создан: 2024-12-19*
